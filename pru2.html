<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación de TV</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <h1>Programación Actual de TV</h1>

    <table id="programming-table">
        <thead>
            <tr>
                <th>Hora de Inicio</th>
                <th>Programa</th>
                <th>Canal</th>
                <th>Descripción</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los programas actuales de La 1 y La 2 serán insertados aquí -->
        </tbody>
    </table>

    <script>
        // Cargar el archivo XML
        function loadXMLFile(filePath, callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    callback(this.responseXML);
                }
            };
            xhttp.open("GET", filePath, true);
            xhttp.send();
        }

        // Obtener la hora actual en formato 'YYYYMMDDHHMMSS'
        function getCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            return `${year}${month}${day}${hours}${minutes}${seconds}`;
        }

        // Función para mostrar solo los programas actuales de La 1 y La 2
        function mostrarProgramacionActual(xml) {
            const programmes = xml.getElementsByTagName('programme');
            const tableBody = document.querySelector("#programming-table tbody");
            const currentTime = getCurrentTime();

            // Limpiar la tabla antes de agregar los programas actuales
            tableBody.innerHTML = '';

            // Recorrer todos los programas y agregar solo los que estén en curso en La 1 o La 2
            for (let i = 0; i < programmes.length; i++) {
                const programme = programmes[i];

                // Obtener los datos del programa
                const startTime = programme.getAttribute("start");
                const endTime = programme.getAttribute("stop");
                const channelId = programme.getAttribute("channel");
                const title = programme.getElementsByTagName("title")[0].textContent;
                const description = programme.getElementsByTagName("desc")[0].textContent;

                // Filtrar los programas de "La 1" o "La 2" y verificar si están en curso
                if ((channelId === "La 1" || channelId === "La 2") &&
                    currentTime >= startTime && currentTime <= endTime) {

                    // Obtener el nombre del canal
                    const channels = xml.getElementsByTagName('channel');
                    let channelName = '';
                    for (let j = 0; j < channels.length; j++) {
                        const channel = channels[j];
                        if (channel.getAttribute("id") === channelId) {
                            channelName = channel.getElementsByTagName("display-name")[0].textContent;
                            break;
                        }
                    }

                    // Crear una nueva fila para la tabla
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${startTime}</td>
                        <td>${title}</td>
                        <td>${channelName}</td>
                        <td>${description}</td>
                    `;
                    tableBody.appendChild(row);
                }
            }
        }

        // Cargar el archivo XML y mostrar la programación actual de La 1 y La 2
        loadXMLFile('https://raw.githubusercontent.com/davidmuma/EPG_dobleM/master/guiatv.xml', mostrarProgramacionActual); // Asegúrate de que el archivo XML esté en la ubicación correcta
    </script>
</body>
</html>
