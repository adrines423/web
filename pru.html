<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación Actual de TV</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <h1>Programación Actual de TV</h1>
    <table id="programming-table">
        <thead>
            <tr>
                <th>Hora de Inicio</th>
                <th>Programa</th>
                <th>Canal</th>
                <th>Descripción</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los programas actuales serán insertados aquí -->
        </tbody>
    </table>

    <script>
        // Función para leer el archivo XML
        function loadXMLFile(filePath, callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    callback(this.responseXML);
                }
            };
            xhttp.open("GET", filePath, true);
            xhttp.send();
        }

        // Obtener la hora actual en formato 'YYYYMMDDHHMMSS'
        function getCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            return `${year}${month}${day}${hours}${minutes}${seconds}`;
        }

        // Función para parsear el XML y mostrar solo los programas activos
        function parseEPG(xml) {
            const programmes = xml.getElementsByTagName('programme');
            const tableBody = document.querySelector("#programming-table tbody");
            const currentTime = getCurrentTime();

            // Limpiar la tabla antes de agregar los programas actuales
            tableBody.innerHTML = '';

            for (let i = 0; i < programmes.length; i++) {
                const programme = programmes[i];

                // Obtener los datos del programa
                const startTime = programme.getAttribute("start");
                const endTime = programme.getAttribute("stop");
                const channelId = programme.getAttribute("channel");
                const title = programme.getElementsByTagName("title")[0].textContent;
                const description = programme.getElementsByTagName("desc")[0].textContent;

                // Filtrar si el programa está en curso (hora actual entre start y stop)
                if (currentTime >= startTime && currentTime <= endTime) {
                    // Obtener el nombre del canal
                    const channels = xml.getElementsByTagName('channel');
                    let channelName = '';
                    for (let j = 0; j < channels.length; j++) {
                        const channel = channels[j];
                        if (channel.getAttribute("id") === channelId) {
                            channelName = channel.getElementsByTagName("display-name")[0].textContent;
                            break;
                        }
                    }

                    // Crear una nueva fila para la tabla
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${startTime}</td>
                        <td>${title}</td>
                        <td>${channelName}</td>
                        <td>${description}</td>
                    `;

                    // Agregar la fila al cuerpo de la tabla
                    tableBody.appendChild(row);
                }
            }
        }

        // Cargar el archivo XML y mostrar la programación actual
        loadXMLFile('https://raw.githubusercontent.com/davidmuma/EPG_dobleM/master/guiatv.xml', parseEPG);  // Asegúrate de que 'epg.xml' esté en el mismo directorio o ponle la ruta correcta.
    </script>
</body>
</html>